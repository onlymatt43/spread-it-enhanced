<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title><%= title %></title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/css/composer.css">
</head>
<body class="composer-dark">
  <div class="composer-backdrop"></div>

  <header class="composer-topbar">
    <div class="brand">Spread It â€” Composer</div>
    <div class="top-actions">
      <button id="toggleChat" class="btn-small">Chat AI</button>
      <a href="/create" class="btn-small muted">Ancien UI</a>
    </div>
  </header>

  <main class="composer-stage">
    <div class="cards-stack" id="cardsStack">
      <div class="post-card underside card-4"></div>
      <div class="post-card underside card-3"></div>
      <div class="post-card underside card-2"></div>
      <div class="post-card top-card card-1" id="activeCard">
        <div class="card-header">
          <div class="platforms">
            <span class="badge p facebook">Facebook</span>
            <span class="badge p twitter">Twitter</span>
            <span class="badge p instagram">Instagram</span>
            <span class="badge p linkedin">LinkedIn</span>
          </div>
          <div class="card-actions">
            <button id="aiPolish" class="btn-accent">AmÃ©liorer (respecter le contenu)</button>
            <button id="switchToChat" class="btn-ghost">Ã‰crire en chat</button>
          </div>
        </div>

        <div class="card-body">
          <div id="postEditor" class="editor" contenteditable="true" data-placeholder="Ã‰crivez votre post ici â€” l'IA corrigera la grammaire et respectera votre contenu."></div>
        </div>

        <div class="card-footer">
          <div class="meta-left">Draft â€¢ <span id="charCount">0</span> caractÃ¨res</div>
          <div class="meta-right">
            <button id="previewBtn" class="btn-outline">AperÃ§u</button>
            <button id="publishBtn" class="btn-primary">Publier</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Platform cards: Real-time visual previews -->
  <section class="platform-cards" id="platformCards">
    <% const platforms = ['facebook','instagram','twitter','linkedin','tiktok']; %>
    <% platforms.forEach(function(p){ %>
      <article class="platform-wrapper" data-platform="<%= p %>">
        
        <!-- Toolbar: Functional Controls -->
        <div class="platform-toolbar">
            <div class="left">
                <label class="toggle-platform"><input type="checkbox" class="platform-select" value="<%= p %>" checked> <span class="p-name"><%= p.charAt(0).toUpperCase()+p.slice(1) %></span></label>
                <% if (typeof configured !== 'undefined' && !configured[p]) { %>
                    <% if (p === 'linkedin') { %>
                        <a href="/auth/linkedin/login" target="_blank" class="status-link disconnected" title="Connecter le compte">ğŸ”— Connecter</a>
                    <% } else { %>
                        <span class="status-badge error" title="Missing credentials">âš  Connecter</span>
                    <% } %>
                <% } %>
            </div>
            <div class="right">
                <button class="btn-xs ghost improve-card">âœ¨ IA Polish</button>
            </div>
        </div>

        <!-- Visual Preview: Mimics the social network UI -->
        <div class="social-preview theme-dark p-<%= p %>">
            <% if(p !== 'tiktok') { %>
            <div class="sp-header">
                <div class="sp-avatar"><img src="https://ui-avatars.com/api/?name=User&background=random" alt=""></div>
                <div class="sp-meta">
                    <div class="sp-name">
                        Mathieu Courchesne 
                        <% if(p==='twitter'||p==='instagram'||p==='facebook'||p==='linkedin'){ %> <span class="verified-badge">âœ”</span> <% } %>
                    </div>
                    <div class="sp-sub">
                        <% if(p==='twitter'){ %> @mathieuc â€¢ 1m <% } %>
                        <% if(p==='facebook'){ %> 1 min â€¢ <span class="globe-icon">ğŸŒ</span> <% } %>
                        <% if(p==='linkedin'){ %> Founder @ Spread It â€¢ 1m â€¢ ğŸŒ <% } %>
                        <% if(p==='instagram'){ %> Sponsored <% } %>
                    </div>
                </div>
                <div class="sp-menu">â€¢â€¢â€¢</div>
            </div>
            <% } %>

            <div class="sp-body">
                <!-- Text Area (Acting as Post Content) -->
                <!-- Order is controlled by CSS per platform (Insta: Media first) -->
                <div class="sp-text-content">
                    <textarea class="platform-caption inputs-invisible" data-platform="<%= p %>" placeholder="Votre texte <%= p %>..."></textarea>
                    <div class="platform-hashtags" data-platform="<%= p %>"></div>
                </div>
                
                <!-- Media Area -->
                <div class="sp-media platform-card-media" data-platform="<%= p %>">
                    <!-- Media injected by JS -->
                </div>

                <% if(p === 'tiktok') { %>
                    <!-- TikTok Overlay UI -->
                    <div class="tiktok-overlay">
                        <div class="tiktok-side">
                           <div class="tt-icon">â™¥</div>
                           <div class="tt-icon">ğŸ’¬</div>
                           <div class="tt-icon">â†ª</div>
                        </div>
                        <div class="tiktok-bottom">
                           <div class="tk-name">@mathieu</div>
                           <div class="tk-desc">Caption goes here... #fyp</div>
                           <div class="tk-sound">â™« Original Sound</div>
                        </div>
                    </div>
                <% } %>
            </div>

            <% if(p !== 'tiktok') { %>
            <div class="sp-footer">
                <% if(p==='twitter'){ %> <span class="act">ğŸ’¬ 2</span> <span class="act">?? 5</span> <span class="act">â™¥ 12</span> <span class="act">ll 300</span> <% } %>
                <% if(p==='facebook'){ %> <div class="fb-acts"><span class="act">ğŸ‘ J'aime</span> <span class="act">ğŸ’¬ Commenter</span> <span class="act">â†ª Partager</span></div> <% } %>
                <% if(p==='linkedin'){ %> <div class="ln-acts"><span class="act">ğŸ‘ J'aime</span> <span class="act">ğŸ’¬ Commenter</span> <span class="act">â™» Republier</span> <span class="act">Envoyer</span></div> <% } %>
                <% if(p==='instagram'){ %> <div class="ig-acts"><span class="act">â™¥</span> <span class="act">ğŸ’¬</span> <span class="act">âœˆ</span> <span class="spacer"></span> <span class="act">ğŸ”–</span></div> <div class="ig-likes">1,234 J'aime</div> <% } %>
            </div>
            <% } %>
        </div>

      </article>
    <% }); %>
  </section>

  <aside class="ai-chat" id="aiChat">
    <div class="ai-header">
      <strong>Assistant AI</strong>
      <button id="closeChat" class="close">âœ•</button>
    </div>
    <div class="ai-messages" id="aiMessages" aria-live="polite"></div>
    <form id="aiForm" class="ai-form">
      <input type="text" id="aiInput" placeholder="Demandez: 'CrÃ©e un thread inspirant sur IA'" autocomplete="off">
      <button type="submit" class="btn-send">Envoyer</button>
    </form>
  </aside>

  <script src="/js/composer.js"></script>
</body>
</html>
